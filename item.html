<html>
<head>
    <title>Opening Item</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <div style="text-align: center; padding: 20px; font-family: Arial, sans-serif;">
        <h2>Opening Item...</h2>
        <p id="status">Checking if app is available...</p>
        <a href="https://play.google.com/store/apps/details?id=com.jaayma.project1" 
           id="playstore-link" 
           style="display: none; background: #4285f4; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;">
           Install App from Play Store
        </a>
    </div>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const itemId = urlParams.get('id');
        const statusEl = document.getElementById('status');
        const playstoreLink = document.getElementById('playstore-link');
        
        if (!itemId) {
            statusEl.textContent = "No item ID provided.";
            playstoreLink.style.display = 'inline-block';
            return;
        }
        
        // Method 1: Try Android Intent (most reliable)
        const intentUrl = `intent://jaayma-app.github.io/item?id=${itemId}#Intent;scheme=https;package=com.jaayma.project1;S.browser_fallback_url=https://play.google.com/store/apps/details?id=com.jaayma.project1;end`;
        
        // Method 2: Try custom scheme
        const customScheme = `jaayma://item?id=${itemId}`;
        
        let hasAppOpened = false;
        let startTime = Date.now();
        
        // Track if user leaves the page (app likely opened)
        window.addEventListener('blur', () => {
            hasAppOpened = true;
        });
        
        // Track page visibility
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                hasAppOpened = true;
            }
        });
        
        // Try to open the app
        function tryOpenApp() {
            // Try Android Intent first
            window.location.href = intentUrl;
            
            // Fallback after 2 seconds
            setTimeout(() => {
                if (!hasAppOpened) {
                    // Try custom scheme as backup
                    window.location.href = customScheme;
                    
                    // Final fallback after another 1 second
                    setTimeout(() => {
                        if (!hasAppOpened) {
                            statusEl.textContent = "App not installed. Install from Play Store:";
                            playstoreLink.style.display = 'inline-block';
                        }
                    }, 1000);
                }
            }, 2000);
        }
        
        // Start the process
        tryOpenApp();
        
        // Backup check using focus/blur events
        setTimeout(() => {
            const timeElapsed = Date.now() - startTime;
            if (timeElapsed > 3000 && !hasAppOpened) {
                statusEl.textContent = "App not installed. Install from Play Store:";
                playstoreLink.style.display = 'inline-block';
            }
        }, 3500);
    </script>
</body>
</html>
